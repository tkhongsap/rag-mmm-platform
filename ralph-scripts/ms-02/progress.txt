# Ralph Progress Log
Started: Fri Feb 20 18:36:59 +07 2026
---

## Codebase Patterns
- Makefile uses `$(PYTHON)` variable — prefer `python3` over `python` since system may not have `python` symlink
- Venv at `.venv/`; activate with `source .venv/bin/activate` or call `.venv/bin/python` directly
- Lint = `py_compile` on `src/rag/__init__.py` and `src/mmm/__init__.py`
- Run all modules from project root: `python -m src.rag.data_processing.run`
---

## 2026-02-20 - US-001
- All three deps already in requirements.txt: llama-index-retrievers-bm25, qdrant-client, llama-index-vector-stores-qdrant
- QDRANT_PATH=data/qdrant_db already documented in .env.example
- Fixed Makefile to use `$(PYTHON)` variable (python3 fallback) so `make lint`/`make test` work on systems without `python` symlink
- Files changed: Makefile
- **Learnings for future iterations:**
  - System only has `python3`, not `python` — Makefile now handles this via `PYTHON ?=` variable
  - All US-001 acceptance criteria were pre-satisfied by prior work; only needed the Makefile fix
---

## 2026-02-20 - US-002
- Added `index_text()` convenience method to RAGIndexer that calls `load_all_text_documents()` from ingest.py
- Changed default embedding model from text-embedding-3-large to text-embedding-3-small (per PRD)
- Updated .env.example to match (EMBEDDING_MODEL + EMBED_MODEL)
- Added `index_assets()` convenience method for US-004 prep
- Files changed: src/rag/embeddings/indexer.py, .env.example
- **Learnings for future iterations:**
  - indexer.py already existed with `build_text_index(docs)` — just needed the convenience loader wrapper
  - `transformations=[]` is critical to prevent implicit SentenceSplitter on pre-chunked docs
  - `_reset_collection()` provides idempotent re-indexing (drop + recreate)
  - RAGIndexer resolves QDRANT_PATH relative to project root via `_resolve_project_path()`
---

## 2026-02-20 - US-003
- BM25 build/load was already implemented in `build_bm25_index(docs)` method
- Persists to `data/index/bm25/` and loads via `BM25Retriever.from_persist_dir()`
- Added `.gitkeep` to `data/index/bm25/` so directory is tracked in git
- Files changed: data/index/bm25/.gitkeep (new)
- **Learnings for future iterations:**
  - `_has_bm25_artifacts()` checks for non-empty dir before deciding load vs build
  - BM25 requires clearing `data/index/bm25/` contents to force rebuild (it loads if artifacts exist)
  - `.gitignore` has `!data/**/.gitkeep` exception to preserve empty directory sentinels
---

## 2026-02-20 - US-004
- campaign_assets collection already implemented: `build_asset_index(docs)` + `index_assets()` convenience method
- `load_asset_documents()` in ingest.py loads from `data/assets/asset_manifest.csv` (50 rows)
- Each doc has `image_path` in metadata (defaulted to "" via `setdefault`)
- Files changed: none (functionality already existed from US-002 prep)
- **Learnings for future iterations:**
  - Asset manifest at `data/assets/asset_manifest.csv` has 50 entries with image_path, channel, vehicle_model, etc.
  - `load_asset_documents()` creates one Document per row with description as text
---
